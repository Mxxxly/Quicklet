{% include "user/userdashnav.html" %}

<main class="container container-main" aria-labelledby="pageTitle">
  <header class="mb-3">
    <h1 id="pageTitle" class="page-title">Payments</h1>
    <p class="lead-muted">
      Complete your reservation securely. Review your booking & pay.
    </p>
  </header>

  <div class="layout">
    <!-- ================= LEFT SIDE ================= -->
    <section>
      <!-- Booking summary top -->
      <div class="panel mb-3">
        <div class="d-flex align-items-start gap-3">

          <!-- Apartment Image -->
          <img 
            src="{{ url_for('static', filename=apartment.pictures[0].apt_image) if apartment.pictures else url_for('static', filename='pic/default.jpg') }}"
            alt="apartment"
            style="width:96px;height:72px;object-fit:cover;border-radius:8px;"
          >

          <div style="flex:1">
            <div style="font-weight:700">{{ apartment.apartment_title }}</div>

            <div class="small-muted">
              {{ check_in }} — {{ check_out }} • {{ guests }} guests
            </div>

            <div class="spacer-large"></div>

            <div class="small-muted">
              Hosted by 
              <strong>{{ apartment.agent.agent_fname|capitalize if apartment.agent else "Host" }}</strong>
            </div>
          </div>

          <div class="chip text-end">
            ₦{{ "{:,.0f}".format(apartment.apartment_price) }}/night
          </div>
        </div>
      </div>

      <!-- Payment Method -->
      <div class="panel mb-3" aria-labelledby="methodsTitle">
        <h5 id="methodsTitle">Payment method</h5>

        <label class="method selected" for="card1">
          <input id="card1" name="payment" type="radio" checked style="display:none;">
          <div class="card-icon">P</div>
          <div style="flex:1">
            <div style="font-weight:700">Paystack</div>
            <div class="small-muted">Pay using Paystack Secure Gateway</div>
          </div>
        </label>
      </div>

      <!-- Security Section -->
      <div class="panel mb-3">
        <h5>Security & support</h5>
        <div class="small-muted">All payments are 100% secure & encrypted.</div>
        <div class="trust mt-3">
          <div class="small-muted"><i class="fa-solid fa-lock"></i> Secure payments</div>
          <div class="small-muted"><i class="fa-solid fa-shield-halved"></i> Verified hosts</div>
          <div class="small-muted"><i class="fa-solid fa-headset"></i> 24/7 support</div>
        </div>
      </div>

    </section>

    <!-- ================= RIGHT SIDE SUMMARY ================= -->
    <aside>
      <div class="summary-card">

        <div class="d-flex justify-content-between align-items-center mb-2">
          <div>
            <div class="small-muted">You're booking</div>
            <div style="font-weight:700">{{ apartment.apartment_title }}</div>
            <div class="small-muted">
              {{ check_in }} — {{ check_out }} • {{ guests }} guests
            </div>
          </div>

          <img 
            src="{{ url_for('static', filename=apartment.pictures[0].apt_image) if apartment.pictures else url_for('static', filename='pic/default.jpg') }}"
            alt="apartment"
            style="width:84px;height:64px;object-fit:cover;border-radius:8px;"
          >
        </div>

        <hr>

        <div class="line">
          <div class="small-muted">Nightly price</div>
          <div>₦{{ "{:,.0f}".format(apartment.apartment_price) }}</div>
        </div>

        <div class="line">
          <div class="small-muted">Nights</div>
          <div>{{ nights }}</div>
        </div>

        <div class="line">
          <div class="small-muted">Booking ref:</div>
          <div>{{ booking_ref }}</div>
        </div>

        <hr>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="small-muted">Total</div>
          <div class="price">₦{{ "{:,.0f}".format(total_amount) }}</div>
        </div>

        <!-- Payment Button -->

        <form action="{{ url_for('paystack_step1') }}" method="POST">
          <input type="hidden" name="csrf_token" value="{{csrf_token()}}">

          <input type="hidden" name="booking_id" value="{{ booking.booking_id }}">
          <input type="hidden" name="booking_ref" value="{{ booking_ref }}">
          <input type="hidden" name="amount" value="{{ total_amount }}">
      
          <div class="d-grid gap-2">
              <button class="btn btn-purple" type="submit">
                  Pay ₦{{ "{:,.0f}".format(total_amount) }}
                  
              </button>
      
              <a href="{{ url_for('apartment_display', apartment_id=apartment.apartment_id) }}" 
                 class="btn btn-outline-secondary">
                  Cancel reservation
              </a>
          </div>
      </form>
      






        <!-- <form action="{{ url_for('paystack_step1') }}" method="POST">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <input type="hidden" name="booking_id" value="{{ booking.booking_id }}">
          <input type="hidden" name="booking_ref" value="{{ booking_ref }}">
          <input type="hidden" name="amount" value="{{ total_amount }}">

          <div class="d-grid gap-2">
            <button class="btn btn-purple" type="submit">
              Pay ₦{{ "{:,.0f}".format(total_amount) }}
            </button>

            <a href="{{ url_for('apartment_display', apartment_id=apartment.apartment_id) }}" 
               class="btn btn-outline-secondary">
              Cancel reservation
            </a>
          </div>
        </form> -->

        <div class="mt-3 small-muted">
          After payment you'll receive an email confirmation and receipt.
        </div>

        <div class="trust mt-3">
          <div class="small-muted">
            <i class="fa-solid fa-circle-check text-success"></i> 
            Free cancellation within 24 hours
          </div>
        </div>

      </div>
    </aside>

  </div> <!-- layout end -->
</main>

</body>
</html>
