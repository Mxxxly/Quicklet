{% extends "user/agentdashboard_page.html" %}

{% block dashtitle %}
<h3 class="mb-3">View Your Bookings</h3>
{% endblock dashtitle %}

{% block dashcontent %}

{% if apartment_bookings %}
<div class="table-responsive">
    <table class="table table-striped table-hover text-center align-middle agent-table">
        <thead class="table-dark">
            <tr>
                <th>S/N</th>
                <th>Apartment</th>
                <th>Picture</th>
                <th>Location</th>
                <th>State</th>
                <th>Number of Bookings</th>
                <th>Booked Users</th>
            </tr>
        </thead>
        <tbody>
            {% for item in apartment_bookings %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ item.apartment.apartment_title }}</td>
                    <td>
                        {% if item.apartment.pictures %}
                            <img src="{{ url_for('static', filename=item.apartment.pictures[0].apt_image) }}" 
                                 alt="Apartment" style="width:100px; height:100px; object-fit:cover; border-radius:5px;">
                        {% else %}
                            <img src="{{ url_for('static', filename='pic/default.jpg') }}" 
                                 alt="Default" style="width:80px; height:60px; object-fit:cover; border-radius:5px;">
                        {% endif %}
                    </td>
                    <td>{{ item.apartment.apartment_address }}</td>
                    <td>{{ item.apartment.state.state_name }}</td>
                    <td>{{ item.bookings_count }}</td>
                    <td>
                        {% for user in item.booked_users %}
                            <div>
                                {{ user.name }} <small class="text-muted">({{ user.booking_date }})</small>
                            </div>
                        {% else %}
                            <div class="text-muted">No bookings yet</div>
                        {% endfor %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info">You have no apartments or no paid bookings yet.</div>
{% endif %}

{% endblock dashcontent %}
